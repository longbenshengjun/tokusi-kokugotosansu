<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ひらがな⇔カタカナゲーム</title>
  <style>
    body {
      font-family: "YuGothic", "ヒラギノ角ゴ Pro W3", sans-serif;
      background: #f0f8ff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
    }
    .start-button {
      background-color: #b2ebf2;
      border: none;
      border-radius: 10px;
      padding: 15px;
      margin: 10px;
      font-size: 1.5em;
      cursor: pointer;
    }
    .question {
      font-size: 3em;
      margin: 20px;
      border: 4px solid #000;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 15px;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .option {
      background-color: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      margin: 10px;
      padding: 15px;
      font-size: 2em;
      cursor: pointer;
      width: 80px;
    }
    .result {
      font-size: 3em;
      margin-top: 20px;
    }
    .score {
      font-size: 1.5em;
      margin: 10px;
    }
    .hidden {
      display: none;
    }
    .highlight {
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 100% { background-color: yellow; }
      50% { background-color: white; }
    }
  </style>
</head>
<body>
  <h1>ひらがなとおなじカタカナをえらぼう</h1>
  <div id="start-screen">
    <button class="start-button" onclick="startGame('ア')">あぎょう</button>
    <button class="start-button" onclick="startGame('カ')">かぎょう</button>
    <button class="start-button" onclick="startGame('サ')">さぎょう</button>
    <button class="start-button" onclick="startGame('タ')">たぎょう</button>
    <button class="start-button" onclick="startGame('ナ')">なぎょう</button>
    <button class="start-button" onclick="startGame('ハ')">はぎょう</button>
    <button class="start-button" onclick="startGame('マ')">まぎょう</button>
    <button class="start-button" onclick="startGame('ヤ')">やぎょう</button>
    <button class="start-button" onclick="startGame('ラ')">らぎょう</button>
    <button class="start-button" onclick="startGame('ワ')">わぎょう</button>
    <button class="start-button" onclick="startGame('all')">ぜんぶ</button>
  </div>

  <div id="game-screen" class="hidden">
    <div class="score" id="score-display"></div>
    <div class="question" id="question-box"></div>
    <div class="options" id="options-box"></div>
    <div class="result" id="result-box"></div>
  </div>

  <div id="end-screen" class="hidden">
    <h2 id="final-score"></h2>
    <img src="images/hanamaru.png" alt="はなまる" width="150" />
  </div>

  <audio id="correct-sound" src="sounds/correct.mp3"></audio>
  <script>
    const hiraToKata = {
      あ: "ア", い: "イ", う: "ウ", え: "エ", お: "オ",
      か: "カ", き: "キ", く: "ク", け: "ケ", こ: "コ",
      さ: "サ", し: "シ", す: "ス", せ: "セ", そ: "ソ",
      た: "タ", ち: "チ", つ: "ツ", て: "テ", と: "ト",
      な: "ナ", に: "ニ", ぬ: "ヌ", ね: "ネ", の: "ノ",
      は: "ハ", ひ: "ヒ", ふ: "フ", へ: "ヘ", ほ: "ホ",
      ま: "マ", み: "ミ", む: "ム", め: "メ", も: "モ",
      や: "ヤ", ゆ: "ユ", よ: "ヨ",
      ら: "ラ", り: "リ", る: "ル", れ: "レ", ろ: "ロ",
      わ: "ワ", を: "ヲ", ん: "ン"
    };

    const gyouMap = {
      ア: ["あ", "い", "う", "え", "お"],
      カ: ["か", "き", "く", "け", "こ"],
      サ: ["さ", "し", "す", "せ", "そ"],
      タ: ["た", "ち", "つ", "て", "と"],
      ナ: ["な", "に", "ぬ", "ね", "の"],
      ハ: ["は", "ひ", "ふ", "へ", "ほ"],
      マ: ["ま", "み", "む", "め", "も"],
      ヤ: ["や", "ゆ", "よ"],
      ラ: ["ら", "り", "る", "れ", "ろ"],
      ワ: ["わ", "を", "ん"]
    };

    let mode = "";
    let questions = [];
    let current = 0;
    let score = 0;
    let timer;
    let lateAnswer = false;

    function startGame(selected) {
      mode = selected;
      document.getElementById("start-screen").classList.add("hidden");
      document.getElementById("game-screen").classList.remove("hidden");
      score = 0;
      current = 0;
      questions = [];
      if (mode === "all") {
        questions = Object.keys(hiraToKata).sort(() => 0.5 - Math.random()).slice(0, 20);
        document.getElementById("score-display").innerText = "てんすう：0てん";
      } else {
        questions = gyouMap[mode].slice();
        document.getElementById("score-display").innerText = "";
      }
      nextQuestion();
    }

    function nextQuestion() {
      if (current >= questions.length) {
        endGame();
        return;
      }
      document.getElementById("result-box").innerText = "";
      const q = questions[current];
      document.getElementById("question-box").innerText = `「 ${q} 」`;

      const correct = hiraToKata[q];
      const options = [correct];
      while (options.length < 7) {
        const r = Object.values(hiraToKata)[Math.floor(Math.random() * Object.values(hiraToKata).length)];
        if (!options.includes(r)) options.push(r);
      }
      options.sort(() => Math.random() - 0.5);

      const box = document.getElementById("options-box");
      box.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("div");
        btn.className = "option";
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(opt, correct);
        box.appendChild(btn);
      });

      lateAnswer = false;
      timer = setTimeout(() => {
        document.querySelectorAll(".option").forEach(btn => {
          if (btn.innerText === correct) {
            btn.classList.add("highlight");
          }
        });
        lateAnswer = true;
      }, 7000);
    }

    function checkAnswer(selected, correct) {
      clearTimeout(timer);
      document.querySelectorAll(".option").forEach(btn => btn.classList.remove("highlight"));

      const result = document.getElementById("result-box");
      if (selected === correct) {
        document.getElementById("correct-sound").play();
        result.innerText = "〇";
        result.style.color = "red";
        if (mode === "all") {
          score += lateAnswer ? 2.5 : 5;
          document.getElementById("score-display").innerText = `てんすう：${Math.round(score)}てん`;
        }
      } else {
        result.innerText = "？";
        result.style.color = "black";
      }
      current++;
      setTimeout(nextQuestion, 1000);
    }

    function endGame() {
      document.getElementById("game-screen").classList.add("hidden");
      if (mode === "all") {
        document.getElementById("end-screen").classList.remove("hidden");
        document.getElementById("final-score").innerText = `あなたのてんすう：${Math.round(score)}てん／100てん`;
        setTimeout(() => location.reload(), 4000);
      } else {
        location.reload();
      }
    }
  </script>
</body>
</html>